<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Bon Appétit Ultimate App</title>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			:root {
				--bg-dark: #0f1011;
				--card-bg: #1e1e1e;
				--accent-gold: #fdc856;
				--text-white: #ffffff;
				--text-gray: #888888;
				--green-glow: radial-gradient(
					circle at 50% 30%,
					rgba(20, 90, 40, 0.6) 0%,
					#0f1011 70%
				);
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				font-family: "Poppins", sans-serif;
				user-select: none; /* Prevent text selection during drag */
			}

			body {
				background-color: #222;
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
				background-image: radial-gradient(
					circle at 50% 50%,
					#333,
					#000
				);
			}

			/* Phone Container */
			.phone-frame {
				width: 375px;
				height: 812px;
				background-color: var(--bg-dark);
				border-radius: 40px;
				box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
				position: relative;
				overflow: hidden;
				border: 8px solid #000;
			}

			/* --- HEADER & NAV --- */
			.header {
				padding: 50px 20px 10px 20px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				z-index: 50;
				position: absolute;
				top: 0;
				width: 100%;
			}

			.menu-icon,
			.profile-icon {
				color: var(--text-white);
				font-size: 1.2rem;
				cursor: pointer;
			}

			.logo-area {
				text-align: center;
				position: relative;
			}

			.logo-arc {
				width: 40px;
				height: 20px;
				border-top: 2px solid orange;
				border-top-left-radius: 40px;
				border-top-right-radius: 40px;
				position: absolute;
				top: -10px;
				left: 50%;
				transform: translateX(-50%);
			}

			.app-name {
				color: var(--text-white);
				font-weight: 600;
				font-size: 1.1rem;
			}

			/* Tabs */
			.tabs {
				display: flex;
				justify-content: center;
				gap: 30px;
				margin-top: 100px; /* offset for fixed header */
				margin-bottom: 20px;
				z-index: 20;
				position: relative;
			}

			.tab {
				color: var(--text-gray);
				font-size: 0.9rem;
				cursor: pointer;
				transition: 0.3s;
				padding-bottom: 5px;
			}

			.tab.active {
				color: var(--text-white);
				font-weight: 500;
				border-bottom: 2px solid var(--text-white);
			}

			/* --- VIEWS --- */
			.view-container {
				width: 100%;
				height: 100%;
				position: absolute;
				top: 0;
				left: 0;
				transition:
					opacity 0.4s ease,
					transform 0.4s ease;
			}

			.view-hidden {
				opacity: 0;
				pointer-events: none;
				z-index: 0;
				transform: scale(0.98);
			}

			.view-active {
				opacity: 1;
				pointer-events: all;
				z-index: 10;
				transform: scale(1);
			}

			#home-view {
			display: flex;
			flex-direction: column;
			justify-content: center;
			padding-bottom: 50px; /* Offset for bottom nav */
		}

		/* --- HOME CAROUSEL --- */
		.carousel-wrapper {
			position: relative;
			height: 450px;
			width: 100%;
			overflow: hidden;
			cursor: grab;
			margin-top: -30px; /* Slight fine-tuning for optical center */
		}

			.carousel-wrapper.dragging .carousel-track {
				transition: none;
			}

			.carousel-wrapper.dragging .carousel-item,
			.carousel-wrapper.dragging .plate-img {
				transition: none;
			}

			.carousel-track {
				display: flex;
				align-items: center;
				height: 100%;
				position: absolute;
				left: 0;
				transition: transform 0.3s ease-out; /* Smooth snap */
			}

			.carousel-item {
				min-width: 375px; /* Width of screen */
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				transform: scale(0.6);
				opacity: 0.5;
				transition:
					transform 0.4s ease,
					opacity 0.4s ease;
			}

			.carousel-item.active {
				transform: scale(1);
				opacity: 1;
			}

			.plate-img {
				width: 260px;
				height: 260px;
				border-radius: 50%;
				object-fit: cover;
				box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
				pointer-events: none; /* Let clicks pass to parent */
				transition: transform 0.4s ease;
			}

			.food-info {
				text-align: center;
				margin-top: 30px;
				color: var(--text-white);
			}

			.food-title {
				font-size: 1.1rem;
				letter-spacing: 1px;
				margin-bottom: 5px;
				text-transform: uppercase;
			}

			.food-sub {
				color: var(--text-gray);
				font-size: 0.8rem;
			}

#detail-view {
			background: #0f1011;
			display: flex;
			flex-direction: column;
			opacity: 0;
			transition: opacity 0.3s ease-in-out;
			overflow: hidden;
		}

		#detail-view.view-active {
			opacity: 1;
		}

		.detail-bg {
			position: absolute;
			inset: 0;
			background-size: cover;
			background-position: center;
			opacity: 1;
			transform: scale(1);
			transition:
				opacity 0.5s ease,
				transform 0.8s ease;
			z-index: 0;
		}

		.detail-overlay {
			position: absolute;
			inset: 0;
			background: linear-gradient(
				180deg,
				rgba(15, 16, 17, 0.1) 0%,
				rgba(15, 16, 17, 0.3) 55%,
				rgba(15, 16, 17, 0.5) 100%
			);
			z-index: 1;
		}

		#detail-view .tabs {
			position: absolute;
			top: 0px;
			left: 0;
			width: 100%;
			z-index: 5; /* Increased z-index */
			pointer-events: auto;
			justify-content: center; /* Center tabs */
			padding-left: 24px; /* Offset for back button */
		}

		#detail-content-area {
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			z-index: 3;
			display: flex;
			flex-direction: column;
			justify-content: flex-end;
			height: 100%;
			pointer-events: none;
		}

		#detail-content-area::-webkit-scrollbar {
			display: none;
		}

		.back-btn {
			position: absolute;
			left: 24px;
			top: 100px; /* Aligned with tabs */
			background: rgba(0, 0, 0, 0.4);
			border: 1px solid rgba(255, 255, 255, 0.1);
			padding: 8px 12px;
			border-radius: 12px;
			color: #fff;
			cursor: pointer;
			z-index: 6; /* Higher than tabs */
			font-size: 1rem;
			backdrop-filter: blur(8px);
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: 0 4px 10px rgba(0,0,0,0.3);
		}

		.detail-content {
			pointer-events: auto;
			flex: 0 0 auto;
			padding: 40px 24px 100px 24px;
			color: white;
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			opacity: 1;
			transform: translateY(0);
			transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
			width: 100%;
			background: linear-gradient(to top, #0f1011 90%, transparent);
			text-shadow: none;
		}

		#detail-view.animating .detail-content {
			opacity: 0;
			transform: translateY(8px);
		}

		#detail-view.animating .detail-bg {
			opacity: 0;
			transform: scale(1.05);
		}

		.detail-content::-webkit-scrollbar {
			display: none;
		}

		.recipe-content {
			display: block;
			transition: opacity 0.3s;
		}

		.recipe-content.hidden {
			display: none;
		}

		#removed-items-floating {
			position: absolute;
			top: 20px;
			left: 20px;
			display: flex;
			flex-direction: column;
			gap: 10px;
			z-index: 10;
		}

		.removed-float-item {
			width: 35px;
			height: 35px;
			position: relative;
			animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
		}

		@keyframes popIn {
			from { transform: scale(0); opacity: 0; }
			to { transform: scale(1); opacity: 1; }
		}

		.removed-float-img {
			width: 100%;
			height: 100%;
			border-radius: 50%;
			object-fit: cover;
			opacity: 0.8;
			filter: grayscale(0.5);
		}

		.removed-float-badge {
			position: absolute;
			top: -4px;
			right: -4px;
			width: 14px;
			height: 14px;
			background: #e74c3c;
			border-radius: 50%;
			display: flex;
			justify-content: center;
			align-items: center;
			color: white;
			font-size: 8px;
			border: 1px solid #000;
		}

			.tags {
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				gap: 10px;
				margin-bottom: 20px;
			}

			.tag {
				font-size: 0.75rem;
				color: #fff;
				background: rgba(255, 255, 255, 0.15);
				padding: 6px 12px;
				border-radius: 20px;
				display: flex;
				align-items: center;
				gap: 6px;
				backdrop-filter: blur(4px);
			}

			.tag i {
				color: #7dff9b;
			}

			.detail-title {
				font-size: 2rem;
				font-weight: 700;
				margin-bottom: 12px;
				text-transform: uppercase;
				line-height: 1.1;
			}

			.detail-desc {
				font-size: 0.9rem;
				color: #ccc;
				line-height: 1.6;
				margin-bottom: 25px;
			}

			.detail-footer {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding-bottom: 20px;
				border-bottom: 1px solid rgba(255,255,255,0.1);
				margin-bottom: 20px;
			}

			.price {
				font-size: 2.2rem;
				font-weight: 700;
				letter-spacing: -1px;
			}

			.add-to-list {
				font-size: 0.9rem;
				color: var(--accent-gold);
				cursor: pointer;
				font-weight: 600;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			/* Customize Area (Bottom of Detail) */
			.customize-panel {
				display: none; /* Hidden by default */
				width: 100%;
				margin-top: 10px;
			}

			.customize-panel.active {
				display: block;
			}

			.ingredients-row {
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: space-between;
				background: rgba(0, 0, 0, 0.8);
				padding: 15px;
				border-radius: 20px;
				backdrop-filter: blur(10px);
			}

			.ingredient-item {
				display: flex;
				flex-direction: column;
				align-items: center;
				position: relative;
				cursor: pointer;
				opacity: 1;
				transition: opacity 0.3s;
			}

			.ingredient-item.removed {
				opacity: 0.4;
			}

			.ing-img {
				width: 45px;
				height: 45px;
				border-radius: 50%;
				object-fit: cover;
				border: none;
			}

			.remove-badge {
				position: absolute;
				top: -2px;
				right: -2px;
				background: #e74c3c;
				width: 16px;
				height: 16px;
				border-radius: 50%;
				display: flex;
				justify-content: center;
				align-items: center;
				color: white;
				font-size: 10px;
				border: 2px solid #1e1e1e;
				z-index: 2;
			}

			.confirm-btn {
				width: 45px;
				height: 45px;
				background: var(--accent-gold);
				border-radius: 12px;
				display: flex;
				justify-content: center;
				align-items: center;
				font-size: 1.2rem;
				cursor: pointer;
				color: #000;
			}

			/* --- LIST VIEW --- */
			#list-view {
				padding-top: 140px;
			}

			.list-container {
				padding: 0 20px;
				height: 580px;
				overflow-y: auto;
			}

			.list-container::-webkit-scrollbar {
				display: none;
			}

			.list-item {
				background-color: var(--card-bg);
				border-radius: 15px;
				padding: 12px;
				margin-bottom: 15px;
				display: flex;
				align-items: center;
				gap: 15px;
				cursor: pointer;
				transition: transform 0.2s;
			}

			.list-item:active {
				transform: scale(0.98);
			}

			.list-img {
				width: 70px;
				height: 70px;
				border-radius: 12px;
				object-fit: cover;
			}

			.list-details {
				flex: 1;
			}
			.list-name {
				color: var(--text-white);
				font-size: 1rem;
				font-weight: 500;
			}
			.list-loc {
				color: var(--text-gray);
				font-size: 0.8rem;
				margin-bottom: 5px;
			}
			.list-desc {
				color: #777;
				font-size: 0.72rem;
				line-height: 1.4;
				margin-top: 4px;
			}
			.rating-row {
				display: flex;
				align-items: center;
				gap: 5px;
				font-size: 0.75rem;
				color: var(--text-gray);
			}
			.stars {
				color: var(--accent-gold);
			}
			.score-badge {
				color: var(--accent-gold);
				font-weight: 700;
				font-size: 1.1rem;
			}

			/* --- BOTTOM NAV --- */
			.bottom-nav {
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
				height: 90px;
				padding: 0 40px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				background: linear-gradient(
					to top,
					rgba(0, 0, 0, 1) 30%,
					transparent
				);
				z-index: 100;
			}

			.nav-btn {
				color: var(--text-gray);
				font-size: 1.2rem;
				cursor: pointer;
				transition: 0.2s;
			}
			.nav-btn.active {
				color: var(--accent-gold);
			}

			.add-btn {
				background-color: var(--accent-gold);
				width: 50px;
				height: 50px;
				border-radius: 15px;
				display: flex;
				justify-content: center;
				align-items: center;
				color: #000;
				font-size: 1.2rem;
				margin-bottom: 20px;
				box-shadow: 0 5px 15px rgba(253, 200, 86, 0.3);
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div class="phone-frame">
			<!-- Header -->
			<div class="header">
				<i class="fas fa-bars menu-icon"></i>
				<div class="logo-area">
					<div class="logo-arc"></div>
					<div class="app-name">Bon appetit<span>!</span></div>
				</div>
				<i class="fas fa-bell profile-icon"></i>
			</div>

			<!-- --- HOME VIEW --- -->
			<div id="home-view" class="view-container view-active">
				<!-- Removed tabs from home view as requested -->
				<div style="height: 40px;"></div> 

				<div class="carousel-wrapper" id="carouselWrapper">
					<div class="carousel-track" id="track">
						<!-- Slides injected by JS -->
					</div>
				</div>

				<!-- Hint overlay for bottom -->
				<div
					style="
						text-align: center;
						color: #555;
						font-size: 0.7rem;
						position: absolute;
						bottom: 100px;
						width: 100%;
					"
				>
					<i class="fas fa-chevron-up"></i><br />Swipe for restaurants
				</div>
			</div>

			<!-- --- DETAIL VIEW --- -->
			<div id="detail-view" class="view-container view-hidden">
				<div class="detail-bg" id="detail-bg"></div>
				<div class="detail-overlay"></div>
				<div class="tabs">
					<div
						class="tab active"
						id="detail-tab-recipe"
						onclick="switchDetailTab('recipe')"
					>
						Recipes
					</div>
					<div
						class="tab"
						id="detail-tab-customize"
						onclick="switchDetailTab('customize')"
					>
						Customize
					</div>
				</div>

				<div class="back-btn" onclick="goToHome()">
					<i class="fas fa-arrow-left"></i>
				</div>
				<div id="detail-content-area">
					<!-- Injected via JS -->
				</div>
			</div>

			<!-- --- LIST VIEW --- -->
			<div id="list-view" class="view-container view-hidden">
				<!-- Reuse header tabs visual only -->
				<div
					class="tabs"
					style="position: absolute; top: 0; width: 100%"
				>
					<div class="tab">Recipes</div>
					<div class="tab">Customize</div>
				</div>
				<div class="list-container" id="list-container">
					<!-- Injected via JS -->
				</div>
			</div>

			<!-- Bottom Nav -->
			<div class="bottom-nav">
				<div class="nav-btn" id="nav-list" onclick="goToList()">
					<i class="fas fa-store"></i>
				</div>
				<div class="add-btn">
					<i class="fas fa-plus"></i>
				</div>
				<div class="nav-btn active" id="nav-home" onclick="goToHome()">
					<i class="fas fa-home"></i>
				</div>
			</div>
		</div>

		<script>
			// --- DATA ---
			const restaurants = [
				{
					name: "El rinconcito",
					img: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80",
					rating: "9,2",
					reviews: 70,
					desc: "Seasonal Spanish plates with citrus-forward seafood and rustic tapas.",
				},
				{
					name: "Burguer Town",
					img: "https://images.unsplash.com/photo-1550547660-d9450f859349?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80",
					rating: "7,2",
					reviews: 22,
					desc: "Smoky grilled specials, tacos, and bold house sauces.",
				},
				{
					name: "Mandala Crunch",
					img: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80",
					rating: "6,5",
					reviews: 38,
					desc: "Healthy bowls packed with greens, grains, and clean flavors.",
				},
				{
					name: "Veggie Tie",
					img: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80",
					rating: "8,1",
					reviews: 12,
					desc: "Plant-forward comfort dishes with modern plating.",
				},
			];
			const recipes = [
				{
					id: 0,
					title: "Wallpapered Trout",
					restaurant: "El rinconcito",
					img: "https://images.unsplash.com/photo-1540420773420-3366772f4999?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
					price: "24€",
					rating: "9,2",
					desc: "Fresh trout marinated in citrus juices, served with wild asparagus and a hint of saffron.",
					ingredients: ["Fish", "Lemon", "Asparagus", "Saffron"],
				},
				{
					id: 1,
					title: "Cebiche de pata de mula",
					restaurant: "Burguer Town",
					img: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
					price: "35€",
					rating: "7,2",
					desc: "Roasted chicken taco, smoked and marinated in beer with a cow bean puree and tatemados chili sauce.",
					ingredients: ["Chicken", "Chili", "Corn", "Beer"],
				},
				{
					id: 2,
					title: "Mandala Crunch",
					restaurant: "Mandala Crunch",
					img: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
					price: "18€",
					rating: "6,5",
					desc: "A healthy bowl of fresh vegetables, quinoa, and avocado topped with sesame seeds.",
					ingredients: ["Avocado", "Quinoa", "Spinach", "Sesame"],
				},
				{
					id: 3,
					title: "Veggie Tie",
					restaurant: "Veggie Tie",
					img: "https://images.unsplash.com/photo-1626804475297-411d863452ef?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
					price: "22€",
					rating: "8,1",
					desc: "Grilled root vegetables served with a balsamic glaze and pine nuts.",
					ingredients: ["Carrots", "Beets", "Balsamic", "Nuts"],
				},
			];

			const ingredientImages = {
				Fish: "https://cdn-icons-png.flaticon.com/512/3058/3058995.png",
				Lemon: "https://cdn-icons-png.flaticon.com/512/517/517563.png",
				Asparagus:
					"https://cdn-icons-png.flaticon.com/512/1135/1135546.png",
				Saffron:
					"https://cdn-icons-png.flaticon.com/512/4861/4861536.png",
				Chicken:
					"https://cdn-icons-png.flaticon.com/512/1057/1057398.png",
				Chili: "https://cdn-icons-png.flaticon.com/512/2918/2918076.png",
				Corn: "https://cdn-icons-png.flaticon.com/512/1135/1135528.png",
				Beer: "https://cdn-icons-png.flaticon.com/512/931/931949.png",
				Avocado:
					"https://cdn-icons-png.flaticon.com/512/753/753820.png",
				Quinoa: "https://cdn-icons-png.flaticon.com/512/4669/4669466.png",
				Spinach:
					"https://cdn-icons-png.flaticon.com/512/1135/1135522.png",
				Sesame: "https://cdn-icons-png.flaticon.com/512/5029/5029236.png",
				Carrots:
					"https://cdn-icons-png.flaticon.com/512/234/234099.png",
				Beets: "https://cdn-icons-png.flaticon.com/512/1514/1514935.png",
				Balsamic:
					"https://cdn-icons-png.flaticon.com/512/119/119047.png",
				Nuts: "https://cdn-icons-png.flaticon.com/512/1652/1652078.png",
			};

			// --- STATE ---
			let currentIndex = 1; // Start with index 1
			let currentView = "home";
			let isDragging = false;
			let hasMoved = false;
			let startPos = 0;
			let currentTranslate = 0;
			let prevTranslate = 0;
			let animationID = 0;
			const itemWidth = 375;

			// --- INITIALIZATION ---
			const track = document.getElementById("track");
			const carouselWrapper = document.getElementById("carouselWrapper");
			const detailBg = document.getElementById("detail-bg");

			function init() {
				// Build Carousel
				track.innerHTML = "";
				recipes.forEach((recipe, index) => {
					const div = document.createElement("div");
					div.className = "carousel-item";
					div.innerHTML = `
                    <img src="${recipe.img}" class="plate-img" draggable="false">
                    <div class="food-info">
                        <h2 class="food-title">${recipe.title}</h2>
                        <p class="food-sub">3 New recipes!</p>
                    </div>
                `;
					// Add click event for opening detail
					div.onclick = () => {
						if (!hasMoved) openDetail(index);
					};
					track.appendChild(div);
				});

				// Build Restaurant List
				const listContainer = document.getElementById("list-container");
				listContainer.innerHTML = "";
				restaurants.forEach((restaurant) => {
					const item = document.createElement("div");
					item.className = "list-item";
					item.onclick = () => openRestaurant(restaurant.name);
					item.innerHTML = `
					<img src="${restaurant.img}" alt="Restaurant" class="list-img">
					<div class="list-details">
						<div class="list-name">${restaurant.name}</div>
						<div class="list-loc">Madrid</div>
						<div class="rating-row">
							<span class="stars">★★★★★</span>
							<span>(${restaurant.reviews}) Reviews</span>
						</div>
						<div class="list-desc">${restaurant.desc}</div>
					</div>
					<div class="score-badge">${restaurant.rating}</div>
				`;
					listContainer.appendChild(item);
				});

				updateCarouselPosition();
			}

			// --- CAROUSEL LOGIC ---
			function updateCarouselPosition() {
				const items = document.querySelectorAll(".carousel-item");
				items.forEach((item, i) => {
					if (i === currentIndex) item.classList.add("active");
					else item.classList.remove("active");
				});

				const translateX = -currentIndex * itemWidth;
				currentTranslate = translateX;
				prevTranslate = translateX;
				track.style.transform = `translateX(${translateX}px)`;
				updateItemTransforms(translateX);
			}

			function updateItemTransforms(translateX) {
				const items = document.querySelectorAll(".carousel-item");
				const progress = (translateX - -currentIndex * itemWidth) / itemWidth;
				items.forEach((item, i) => {
					const distance = i - currentIndex + progress;
					const absDistance = Math.abs(distance);
					const scale = Math.max(0.6, 1 - absDistance * 0.35);
					const opacity = Math.max(0.4, 1 - absDistance * 0.5);
					item.style.transform = `scale(${scale})`;
					item.style.opacity = opacity;
					const plate = item.querySelector(".plate-img");
					if (plate) {
						plate.style.transform = `rotate(${distance * -18}deg)`;
					}
				});
			}

			// Drag Events
			carouselWrapper.addEventListener("mousedown", touchStart);
			carouselWrapper.addEventListener("touchstart", touchStart, {
				passive: false,
			});
			carouselWrapper.addEventListener("mouseup", touchEnd);
			carouselWrapper.addEventListener("mouseleave", touchEnd);
			carouselWrapper.addEventListener("touchend", touchEnd);
			carouselWrapper.addEventListener("mousemove", touchMove);
			carouselWrapper.addEventListener("touchmove", touchMove, {
				passive: false,
			});

			function touchStart(event) {
				isDragging = true;
				hasMoved = false;
				startPos = getPositionX(event);
				prevTranslate = currentTranslate;
				animationID = requestAnimationFrame(animation);
				carouselWrapper.style.cursor = "grabbing";
				carouselWrapper.classList.add("dragging");
			}

			function touchMove(event) {
				if (!isDragging) return;
				if (event.type === "touchmove") event.preventDefault();
				const currentPosition = getPositionX(event);
				currentTranslate = prevTranslate + currentPosition - startPos;
			}

			function touchEnd() {
				isDragging = false;
				cancelAnimationFrame(animationID);
				carouselWrapper.style.cursor = "grab";
				carouselWrapper.classList.remove("dragging");

				const movedBy = currentTranslate - prevTranslate;
				hasMoved = Math.abs(movedBy) > 5;
				const threshold = itemWidth * 0.2;

				if (movedBy < -threshold && currentIndex < recipes.length - 1)
					currentIndex += 1;
				if (movedBy > threshold && currentIndex > 0) currentIndex -= 1;

				updateCarouselPosition();
			}

			function getPositionX(event) {
				return event.type.includes("mouse")
					? event.pageX
					: event.touches[0].clientX;
			}

			function animation() {
				if (isDragging) {
					track.style.transform = `translateX(${currentTranslate}px)`;
					updateItemTransforms(currentTranslate);
					requestAnimationFrame(animation);
				}
			}

			// --- NAVIGATION LOGIC ---
			function goToHome() {
				document
					.getElementById("home-view")
					.classList.remove("view-hidden");
				document
					.getElementById("home-view")
					.classList.add("view-active");
				document
					.getElementById("list-view")
					.classList.add("view-hidden");
				document
					.getElementById("list-view")
					.classList.remove("view-active");
				document
					.getElementById("detail-view")
					.classList.add("view-hidden");
				document
					.getElementById("detail-view")
					.classList.remove("view-active");

				document.getElementById("nav-home").classList.add("active");
				document.getElementById("nav-list").classList.remove("active");
			}

			function goToList() {
				document
					.getElementById("home-view")
					.classList.add("view-hidden");
				document
					.getElementById("home-view")
					.classList.remove("view-active");
				document
					.getElementById("list-view")
					.classList.remove("view-hidden");
				document
					.getElementById("list-view")
					.classList.add("view-active");
				document
					.getElementById("detail-view")
					.classList.add("view-hidden");
				document
					.getElementById("detail-view")
					.classList.remove("view-active");

				document.getElementById("nav-home").classList.remove("active");
				document.getElementById("nav-list").classList.add("active");
			}

			function openRestaurant(restaurantName) {
				const index = recipes.findIndex(
					(recipe) => recipe.restaurant === restaurantName,
				);
				if (index >= 0) {
					currentIndex = index;
					updateCarouselPosition();
				}
				goToHome();
			}

			function openDetail(index) {
				currentIndex = index; // Sync index
				const recipe = recipes[index];
				const detailArea = document.getElementById(
					"detail-content-area",
				);
				detailBg.style.backgroundImage = `url("${recipe.img}")`;

			// Build Detail HTML with new layout
			detailArea.innerHTML = `
				<div class="detail-content">
					<div class="recipe-content" id="recipe-content" style="position: relative;">
						<!-- Container for floating removed items -->
						<div id="removed-items-floating"></div>

						<div class="tags">
							<div class="tag"><i class="fas fa-leaf"></i> Saludable</div>
							<div class="tag"><i class="fas fa-percentage"></i> Bajo en grasa</div>
							<div class="tag"><i class="fas fa-utensils"></i> Receta disponible</div>
						</div>

						<h2 class="detail-title">${recipe.title}</h2>
						<p class="detail-desc">${recipe.desc}</p>

						<!-- Standard Footer (Price) -->
						<div id="info-panel" class="detail-footer">
							<div class="price">${recipe.price}</div>
							<div style="display:flex; flex-direction:column; align-items:flex-end;">
								<div class="add-to-list"><i class="fas fa-plus"></i> Add to list</div>
								<div style="font-size:0.75rem; color:#888; margin-top:5px;">★★★★★ (70) Reviews</div>
							</div>
						</div>

						<!-- Restaurant Link logic -->
						<div style="margin-top: 10px;">
							<p style="font-size:0.7rem; color:#888; margin-bottom:10px; text-transform:uppercase; letter-spacing:1px; font-weight:600;">Available at:</p>
							<div class="list-item" style="padding: 12px; background: rgba(30, 30, 30, 0.8); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);">
								<img src="${recipe.img}" style="width:45px; height:45px; border-radius:10px; object-fit:cover;">
								<div class="list-details">
									<div class="list-name" style="font-size:0.95rem;">${recipe.restaurant}</div>
									<div class="list-loc" style="margin:0;">Madrid</div>
								</div>
								<div class="score-badge" style="font-size:1rem;">${recipe.rating}</div>
							</div>
						</div>
					</div>

					<!-- Customize Panel (Hidden initially) -->
					<div id="customize-panel" class="customize-panel">
						<!-- Centered Title for customize view -->
						<div style="text-align: center; margin-bottom: 30px;">
							<h2 class="detail-title" style="font-size: 1.5rem;">${recipe.title}</h2>
							<p style="color: #888; font-size: 0.8rem;">3 New recipes!</p>
						</div>

						<div class="ingredients-row">
							${recipe.ingredients
								.map(
									(ing) => `
									<div class="ingredient-item" onclick="toggleIng(this)">
										<div class="remove-badge"><i class="fas fa-minus"></i></div>
										<img src="${ingredientImages[ing] || "https://via.placeholder.com/45"}" class="ing-img">
									</div>
								`,
								)
								.join("")}
							<div class="confirm-btn" onclick="confirmCustomization()">
								<i class="fas fa-check"></i>
							</div>
						</div>
					</div>
				</div>
			`;

			// Reset tabs visual
			document
				.getElementById("detail-tab-recipe")
				.classList.add("active");
			document
				.getElementById("detail-tab-customize")
			.classList.remove("active");

		// Show View
		const detailView = document.getElementById("detail-view");
		detailView.classList.add("animating");
		document
			.getElementById("detail-view")
			.classList.remove("view-hidden");
		document
			.getElementById("detail-view")
			.classList.add("view-active");
		document
			.getElementById("home-view")
			.classList.add("view-hidden");
		document
			.getElementById("home-view")
			.classList.remove("view-active");
		document
			.getElementById("list-view")
			.classList.add("view-hidden");
		document
			.getElementById("list-view")
			.classList.remove("view-active");

		requestAnimationFrame(() => {
			detailView.classList.remove("animating");
		});
	}

	// --- CUSTOMIZE LOGIC ---
	function switchDetailTab(tabName) {
		const recipeContent = document.getElementById("recipe-content");
		const custPanel = document.getElementById("customize-panel");
		const rTab = document.getElementById("detail-tab-recipe");
		const cTab = document.getElementById("detail-tab-customize");

		if (tabName === "customize") {
			recipeContent.classList.add("hidden");
			custPanel.classList.add("active");
			rTab.classList.remove("active");
			cTab.classList.add("active");
		} else {
			recipeContent.classList.remove("hidden");
			custPanel.classList.remove("active");
			rTab.classList.add("active");
			cTab.classList.remove("active");
		}
	}

	function toggleIng(element) {
		element.classList.toggle("removed");
	}

	function confirmCustomization() {
		// 1. Gather removed items
		const removedItems = document.querySelectorAll('#customize-panel .ingredient-item.removed');
		const removedSources = [];
		removedItems.forEach(item => {
			const img = item.querySelector('.ing-img');
			if (img) removedSources.push(img.src);
		});

		// 2. Simulate update
		const btn = document.querySelector(".confirm-btn");
		const originalContent = btn.innerHTML;
		btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

		setTimeout(() => {
			btn.innerHTML = '<i class="fas fa-check"></i>';
			
			// 3. Update the main recipe view with removed items
			const floatContainer = document.getElementById('removed-items-floating');
			floatContainer.innerHTML = ''; // Clear previous
			removedSources.forEach(src => {
				const div = document.createElement('div');
				div.className = 'removed-float-item';
				div.innerHTML = `
					<img src="${src}" class="removed-float-img">
					<div class="removed-float-badge"><i class="fas fa-minus"></i></div>
				`;
				floatContainer.appendChild(div);
			});

			setTimeout(() => {
				// Switch back
				switchDetailTab("recipe");
				// Restore button
				btn.innerHTML = originalContent;
			}, 400);

		}, 600);
	}

			// Init
			init();
		</script>
	</body>
</html>
