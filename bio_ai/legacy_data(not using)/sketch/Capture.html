<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Bio AI - Snap Log</title>
		<link
			href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Inter:wght@400;500;600&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>

		<style>
			:root {
				/* Brand Colors (Same as Dashboard) */
				--primary: #4b7bff;
				--primary-gradient: linear-gradient(
					135deg,
					#4b7bff 0%,
					#2563eb 100%
				);
				--accent-green: #10b981;
				--accent-orange: #f59e0b;
				--bg-body: #000000; /* Camera bg is black */
				--surface: #ffffff;
				--text-main: #1e293b;
				--text-secondary: #64748b;
				--radius-card: 24px;
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				-webkit-tap-highlight-color: transparent;
			}

			body {
				font-family: "DM Sans", sans-serif;
				background-color: var(--bg-body);
				display: flex;
				justify-content: center;
				height: 100vh;
				overflow: hidden;
			}

			.app-container {
				width: 100%;
				max-width: 414px;
				height: 100%;
				background-color: #000;
				position: relative;
				overflow: hidden;
			}

			/* --- VIEW 1: CAMERA INTERFACE --- */
			.camera-view {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				/* Simulating Camera Feed */
				background: url("https://images.unsplash.com/photo-1544025162-d76694265947?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80")
					no-repeat center center;
				background-size: cover;
				z-index: 1;
			}

			/* Dark Overlay for UI visibility */
			.camera-overlay-top {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				padding: 50px 24px 20px;
				background: linear-gradient(
					to bottom,
					rgba(0, 0, 0, 0.6),
					transparent
				);
				display: flex;
				justify-content: space-between;
				align-items: center;
				color: white;
				z-index: 2;
			}

			.cam-icon-btn {
				width: 40px;
				height: 40px;
				border-radius: 50%;
				background: rgba(255, 255, 255, 0.2);
				backdrop-filter: blur(10px);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 18px;
				cursor: pointer;
				color: inherit;
				text-decoration: none;
			}

			.cam-icon-btn.offline-active {
				background: rgba(245, 158, 11, 0.8);
				color: #1e293b;
			}

			/* AR Reticle (Focus Box) */
			.ar-reticle {
				position: absolute;
				top: 40%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 250px;
				height: 250px;
				border: 2px solid rgba(255, 255, 255, 0.5);
				border-radius: 20px;
				box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.3); /* Dim outside area */
				z-index: 2;
			}

			/* Techy corners for AR feel */
			.ar-reticle::after,
			.ar-reticle::before {
				content: "";
				position: absolute;
				width: 20px;
				height: 20px;
				border-color: var(--primary);
				border-style: solid;
				transition: 0.3s;
			}
			.ar-reticle::before {
				top: -2px;
				left: -2px;
				border-width: 4px 0 0 4px;
				border-radius: 6px 0 0 0;
			}
			.ar-reticle::after {
				bottom: -2px;
				right: -2px;
				border-width: 0 4px 4px 0;
				border-radius: 0 0 6px 0;
			}

			.ar-tag {
				position: absolute;
				top: -30px;
				left: 50%;
				transform: translateX(-50%);
				background: var(--primary);
				padding: 4px 12px;
				border-radius: 12px;
				font-size: 12px;
				font-weight: 600;
				color: white;
				opacity: 0.9;
				white-space: nowrap;
			}

			/* Bottom Controls */
			.camera-controls {
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
				padding-bottom: 40px;
				background: linear-gradient(
					to top,
					rgba(0, 0, 0, 0.8),
					transparent
				);
				display: flex;
				flex-direction: column;
				align-items: center;
				z-index: 3;
			}

			.offline-banner {
				position: absolute;
				top: 110px;
				left: 50%;
				transform: translateX(-50%);
				background: rgba(15, 23, 42, 0.85);
				color: white;
				padding: 6px 12px;
				border-radius: 12px;
				font-size: 11px;
				display: none;
				z-index: 4;
			}

			.offline-on .offline-banner {
				display: block;
			}

			.scan-modes {
				display: flex;
				gap: 24px;
				margin-bottom: 24px;
			}

			.mode-item {
				color: rgba(255, 255, 255, 0.6);
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
				text-transform: uppercase;
				letter-spacing: 1px;
			}
			.mode-item.active {
				color: white;
				text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
			}

			.shutter-ring {
				width: 72px;
				height: 72px;
				border: 4px solid white;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				transition: transform 0.1s;
			}
			.shutter-inner {
				width: 60px;
				height: 60px;
				background: white;
				border-radius: 50%;
			}
			.shutter-ring:active {
				transform: scale(0.95);
				opacity: 0.8;
			}

			/* --- VIEW 2: ANALYSIS SHEET (Initially Hidden) --- */
			.analysis-sheet {
				position: absolute;
				bottom: -100%; /* Hidden off-screen */
				left: 0;
				width: 100%;
				background: #f2f5f9;
				border-radius: 30px 30px 0 0;
				z-index: 10;
				transition: bottom 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
				display: flex;
				flex-direction: column;
				max-height: 85vh;
				box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);
			}

			.sheet-active .analysis-sheet {
				bottom: 0;
			}

			.sheet-handle {
				width: 40px;
				height: 5px;
				background: #cbd5e1;
				border-radius: 10px;
				margin: 12px auto;
			}

			.sheet-content {
				padding: 0 24px 30px;
				overflow-y: auto;
			}

			.sheet-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
			}
			.sheet-header h2 {
				font-size: 20px;
				color: var(--text-main);
			}
			.edit-btn {
				color: var(--primary);
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
			}

			/* Food Item Row */
			.food-item-card {
				background: white;
				border-radius: 20px;
				padding: 16px;
				display: flex;
				align-items: center;
				gap: 16px;
				box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
				margin-bottom: 16px;
				position: relative;
			}

			.food-thumb {
				width: 60px;
				height: 60px;
				border-radius: 12px;
				object-fit: cover;
				background: #eee;
			}

			.food-details {
				flex: 1;
			}
			.food-details h3 {
				font-size: 16px;
				font-weight: 700;
				color: var(--text-main);
			}
			.food-details p {
				font-size: 13px;
				color: var(--text-secondary);
				margin-top: 2px;
			}

			.remove-btn {
				color: #cbd5e1;
				cursor: pointer;
				padding: 5px;
			}

			/* Portion Slider Control */
			.portion-control-container {
				margin-top: 10px;
				background: #f8fafc;
				padding: 12px;
				border-radius: 16px;
			}

			.portion-label {
				font-size: 12px;
				color: var(--text-secondary);
				font-weight: 600;
				margin-bottom: 8px;
				display: block;
			}

			.portion-slider {
				display: flex;
				background: #e2e8f0;
				border-radius: 12px;
				padding: 4px;
				position: relative;
			}

			.p-option {
				flex: 1;
				text-align: center;
				padding: 8px 0;
				font-size: 13px;
				font-weight: 600;
				color: var(--text-secondary);
				cursor: pointer;
				z-index: 2;
				transition: color 0.3s;
			}

			.p-option.active {
				color: white;
			}

			/* Animated Slider Background */
			.p-bg {
				position: absolute;
				top: 4px;
				bottom: 4px;
				width: 33.33%;
				background: var(--text-main);
				border-radius: 9px;
				transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
				z-index: 1;
				left: 33.33%; /* Default Medium */
			}

			/* Manual Add Row */
			.manual-add-row {
				display: flex;
				align-items: center;
				gap: 10px;
				padding: 12px 0;
				cursor: pointer;
				color: var(--primary);
				font-weight: 600;
				font-size: 14px;
			}

			/* Summary Footer */
			.macro-summary {
				margin-top: 10px;
				padding-top: 20px;
				border-top: 1px solid #e2e8f0;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.macro-tag {
				background: #eff6ff;
				color: var(--primary);
				padding: 6px 12px;
				border-radius: 8px;
				font-size: 12px;
				font-weight: 700;
			}

			.total-cals {
				font-size: 24px;
				font-weight: 800;
				color: var(--text-main);
			}

			.save-btn {
				margin-top: 24px;
				width: 100%;
				background: var(--primary-gradient);
				color: white;
				border: none;
				padding: 16px;
				border-radius: 16px;
				font-size: 16px;
				font-weight: 600;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
				box-shadow: 0 10px 20px rgba(75, 123, 255, 0.25);
				cursor: pointer;
			}

			/* Search Bar (Initially Hidden) */
			.search-overlay {
				position: absolute;
				inset: 0;
				background: var(--surface);
				color: var(--text-main);
				z-index: 40;
				padding: 60px 24px;
				opacity: 0;
				pointer-events: none;
				transform: translateY(12px);
				transition:
					opacity 0.2s ease,
					transform 0.2s ease;
				overflow-y: auto;
			}
			.search-active .search-overlay {
				opacity: 1;
				pointer-events: auto;
				transform: translateY(0);
			}

			.search-active .analysis-sheet {
				bottom: -100%;
			}

			.search-input-box {
				display: flex;
				align-items: center;
				background: #f1f5f9;
				border-radius: 16px;
				padding: 14px 16px;
				gap: 12px;
				color: var(--text-secondary);
			}
			.search-input-box input {
				border: none;
				background: transparent;
				outline: none;
				font-size: 16px;
				width: 100%;
				color: var(--text-main);
			}

			.impact-chips {
				margin-top: 12px;
				display: flex;
				gap: 8px;
			}

			.impact-chip {
				border: none;
				padding: 6px 10px;
				border-radius: 12px;
				font-size: 11px;
				font-weight: 700;
				cursor: pointer;
				background: #eef2ff;
				color: var(--primary);
			}

			.impact-chip.caffeine {
				background: rgba(245, 158, 11, 0.15);
				color: #b45309;
			}
			.impact-chip.alcohol {
				background: rgba(139, 92, 246, 0.15);
				color: #7c3aed;
			}

			.search-results {
				margin-top: 16px;
				display: flex;
				flex-direction: column;
				gap: 10px;
			}

			.search-item {
				background: #f8fafc;
				border-radius: 14px;
				padding: 12px;
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 12px;
			}

			.search-info strong {
				font-size: 13px;
				color: var(--text-main);
				display: block;
			}

			.search-info span {
				font-size: 11px;
				color: var(--text-secondary);
			}

			.search-add {
				border: none;
				background: white;
				color: var(--primary);
				font-weight: 700;
				font-size: 11px;
				padding: 6px 10px;
				border-radius: 10px;
				cursor: pointer;
			}

			.search-empty {
				margin-top: 16px;
				font-size: 12px;
				color: var(--text-secondary);
				display: none;
			}

			.custom-food-btn {
				margin-top: 10px;
				border: none;
				background: var(--text-main);
				color: white;
				padding: 8px 12px;
				border-radius: 10px;
				font-size: 12px;
				font-weight: 700;
				cursor: pointer;
			}

			.custom-food-panel {
				margin-top: 16px;
				background: #f8fafc;
				border-radius: 16px;
				padding: 14px;
				display: none;
			}

			.custom-food-panel.active {
				display: block;
			}

			.custom-food-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 10px;
			}

			.custom-food-header h3 {
				font-size: 14px;
				color: var(--text-main);
			}

			.custom-field {
				display: flex;
				flex-direction: column;
				gap: 4px;
				margin-bottom: 10px;
				font-size: 12px;
				color: var(--text-secondary);
			}

			.custom-field input {
				border: 1px solid #e2e8f0;
				border-radius: 10px;
				padding: 8px 10px;
				font-size: 13px;
				color: var(--text-main);
			}

			.custom-toggle {
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 12px;
				color: var(--text-secondary);
			}

			.custom-actions {
				display: flex;
				gap: 10px;
				margin-top: 12px;
			}

			/* Quick Log */
			.quick-log-row {
				margin-top: 16px;
				padding: 12px;
				border-radius: 16px;
				background: #f1f5f9;
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 12px;
			}

			.quick-log-row strong {
				font-size: 13px;
				color: var(--text-main);
				display: block;
			}
			.quick-log-row span {
				font-size: 11px;
				color: var(--text-secondary);
			}

			.quick-log-btn {
				border: none;
				background: white;
				color: var(--text-main);
				padding: 8px 10px;
				border-radius: 10px;
				font-size: 12px;
				font-weight: 600;
				cursor: pointer;
			}

			/* Modals */
			.modal {
				position: fixed;
				inset: 0;
				background: rgba(15, 23, 42, 0.5);
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
				opacity: 0;
				pointer-events: none;
				transition: opacity 0.2s ease;
				z-index: 30;
			}

			.modal.active {
				opacity: 1;
				pointer-events: auto;
			}

			.modal-card {
				width: 100%;
				max-width: 340px;
				background: var(--surface);
				border-radius: 20px;
				padding: 20px;
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
			}

			.modal-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 12px;
			}

			.modal-title {
				font-size: 16px;
				font-weight: 700;
				color: var(--text-main);
			}

			.modal-close {
				border: none;
				background: #f1f5f9;
				width: 32px;
				height: 32px;
				border-radius: 10px;
				cursor: pointer;
			}

			.modal-actions {
				display: flex;
				gap: 10px;
				margin-top: 16px;
			}

			.btn-primary {
				flex: 1;
				background: var(--primary-gradient);
				color: white;
				border: none;
				padding: 12px;
				border-radius: 12px;
				font-weight: 600;
				text-decoration: none;
				text-align: center;
			}

			.btn-secondary {
				flex: 1;
				background: #f1f5f9;
				color: var(--text-main);
				border: none;
				padding: 12px;
				border-radius: 12px;
				font-weight: 600;
				cursor: pointer;
			}

			.nav-grid {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 12px;
			}

			.nav-tile {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 8px;
				padding: 12px;
				border-radius: 16px;
				background: #f8fafc;
				text-decoration: none;
				color: var(--text-main);
				font-size: 12px;
				font-weight: 600;
			}

			.nav-tile i {
				font-size: 20px;
				color: var(--primary);
			}

			/* Barcode Overlay */
			.barcode-overlay {
				position: absolute;
				inset: 0;
				background: rgba(0, 0, 0, 0.85);
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				gap: 16px;
				color: white;
				opacity: 0;
				pointer-events: none;
				transition: opacity 0.2s ease;
				z-index: 60;
			}

			.barcode-overlay.active {
				opacity: 1;
				pointer-events: auto;
			}

			.barcode-frame {
				width: 240px;
				height: 140px;
				border: 2px dashed rgba(255, 255, 255, 0.6);
				border-radius: 12px;
			}

			.barcode-card {
				width: 100%;
				max-width: 280px;
				background: rgba(255, 255, 255, 0.1);
				border-radius: 16px;
				padding: 14px;
				text-align: center;
				display: none;
				flex-direction: column;
				gap: 6px;
			}

			.barcode-card.show {
				display: flex;
			}

			.barcode-meta {
				font-size: 12px;
				color: rgba(255, 255, 255, 0.8);
			}

			.barcode-fail {
				background: none;
				border: none;
				color: rgba(255, 255, 255, 0.7);
				font-size: 12px;
				cursor: pointer;
				text-decoration: underline;
			}

			.barcode-cancel {
				flex: 0;
				width: auto;
				min-width: 120px;
			}

			/* Toast */
			.toast {
				position: fixed;
				bottom: 24px;
				left: 50%;
				transform: translateX(-50%);
				background: rgba(15, 23, 42, 0.9);
				color: white;
				padding: 10px 16px;
				border-radius: 12px;
				font-size: 12px;
				opacity: 0;
				pointer-events: none;
				transition: opacity 0.2s ease;
				z-index: 40;
			}

			.toast.show {
				opacity: 1;
			}
			.toast.success {
				background: rgba(16, 185, 129, 0.9);
			}
			.toast.error {
				background: rgba(239, 68, 68, 0.9);
			}
			.toast.warning {
				background: rgba(245, 158, 11, 0.9);
			}
		</style>
	</head>
	<body class="">
		<!-- Added class for testing logic via JS -->

		<div class="app-container">
			<!-- === SEARCH OVERLAY (View C) === -->
			<div class="search-overlay">
				<div
					style="
						display: flex;
						justify-content: space-between;
						margin-bottom: 20px;
					"
				>
					<h2 style="font-size: 20px">Manual Search</h2>
					<i
						class="fa-solid fa-xmark"
						style="font-size: 24px; cursor: pointer"
						onclick="setMode('scan')"
					></i>
				</div>
				<div class="search-input-box">
					<i class="fa-solid fa-magnifying-glass"></i>
					<input
						id="searchInput"
						type="text"
						placeholder="Search (e.g. Oatmeal, Apple)"
						oninput="filterSearch()"
					/>
					<i
						class="fa-solid fa-barcode"
						style="cursor: pointer"
						onclick="toggleBarcode()"
					></i>
				</div>
				<div class="impact-chips">
					<button
						class="impact-chip caffeine"
						onclick="addImpactItem('caffeine')"
					>
						<i class="fa-solid fa-mug-hot"></i> Caffeine
					</button>
					<button
						class="impact-chip alcohol"
						onclick="addImpactItem('alcohol')"
					>
						<i class="fa-solid fa-wine-glass"></i> Alcohol
					</button>
				</div>
				<div class="search-results" id="searchResults"></div>
				<div class="search-empty" id="searchEmpty">
					No matching foods found.
					<div>
						<button
							class="custom-food-btn"
							onclick="openCustomFood()"
						>
							Create Custom Food
						</button>
					</div>
				</div>
				<div class="custom-food-panel" id="customFoodPanel">
					<div class="custom-food-header">
						<h3>Create Custom Food</h3>
						<button class="modal-close" onclick="closeCustomFood()">
							<i class="fa-solid fa-xmark"></i>
						</button>
					</div>
					<div class="custom-field">
						Name
						<input
							id="customName"
							type="text"
							placeholder="e.g. Local Bakery Muffin"
						/>
					</div>
					<div class="custom-field">
						Calories (required)
						<input
							id="customCalories"
							type="number"
							min="1"
							placeholder="e.g. 340"
						/>
					</div>
					<div class="custom-field">
						Protein (optional)
						<input
							id="customProtein"
							type="number"
							min="0"
							placeholder="e.g. 10"
						/>
					</div>
					<div class="custom-field">
						Fat (optional)
						<input
							id="customFat"
							type="number"
							min="0"
							placeholder="e.g. 12"
						/>
					</div>
					<label class="custom-toggle">
						<input id="customPublic" type="checkbox" />
						Add to public database
					</label>
					<div class="custom-actions">
						<button class="btn-primary" onclick="saveCustomFood()">
							Save Food
						</button>
						<button
							class="btn-secondary"
							onclick="closeCustomFood()"
						>
							Cancel
						</button>
					</div>
				</div>
			</div>

			<div class="barcode-overlay" id="barcodeOverlay">
				<div class="barcode-frame"></div>
				<div
					style="font-size: 14px; font-weight: 600"
					id="barcodeStatus"
				>
					Scan barcode to log packaged food
				</div>
				<div class="barcode-card" id="barcodeCard">
					<strong id="barcodeName">Blueberry Protein Bar</strong>
					<div class="barcode-meta" id="barcodeCode">
						Barcode: 037466028201
					</div>
					<div class="barcode-meta" id="barcodeMacros">
						220 kcal - 12g Protein - 9g Fat
					</div>
					<button class="btn-primary" onclick="addBarcodeItem()">
						Add Item
					</button>
				</div>
				<button class="barcode-fail" onclick="barcodeNotFound()">
					No barcode found
				</button>
				<button
					class="btn-secondary barcode-cancel"
					onclick="toggleBarcode()"
				>
					Cancel
				</button>
			</div>

			<!-- === CAMERA LAYER (View A) === -->
			<div class="camera-view">
				<!-- Top UI -->
				<div class="camera-overlay-top">
					<div
						class="cam-icon-btn"
						onclick="showToast('Flash toggled')"
					>
						<i class="fa-solid fa-bolt"></i>
					</div>
					<!-- Flash -->
					<div
						class="cam-icon-btn"
						id="offlineToggle"
						onclick="toggleOffline()"
						title="Toggle offline"
					>
						<i class="fa-solid fa-signal"></i>
					</div>
					<div style="display: flex; gap: 12px">
						<div
							class="cam-icon-btn"
							onclick="openModal('navModal')"
						>
							<i class="fa-solid fa-grip"></i>
						</div>
						<a
							class="cam-icon-btn"
							href="Dashbaord.html"
							aria-label="Close camera"
							><i class="fa-solid fa-xmark"></i
						></a>
					</div>
				</div>
				<div class="offline-banner" id="offlineBanner">
					Offline mode: Save for later
				</div>

				<!-- AR Reticle -->
				<div class="ar-reticle">
					<div class="ar-tag">
						<i class="fa-solid fa-wand-magic-sparkles"></i> Ribeye
						Steak detected
					</div>
				</div>

				<!-- Bottom Controls -->
				<div class="camera-controls">
					<div class="scan-modes">
						<div
							class="mode-item active"
							data-mode="scan"
							onclick="setMode('scan')"
						>
							Scan
						</div>
						<div
							class="mode-item"
							data-mode="search"
							onclick="setMode('search')"
						>
							Search
						</div>
					</div>

					<!-- Shutter Button (Triggers Analysis) -->
					<div class="shutter-ring" onclick="snapPhoto()">
						<div class="shutter-inner"></div>
					</div>
				</div>
			</div>

			<!-- === ANALYSIS SHEET (View B) === -->
			<div class="analysis-sheet" id="analysisSheet">
				<div class="sheet-handle"></div>

				<div class="sheet-content">
					<div class="sheet-header">
						<h2>Log Meal</h2>
						<div class="edit-btn" onclick="setMode('search')">
							Edit
						</div>
					</div>

					<div id="foodList"></div>

					<!-- Manual Add -->
					<div class="manual-add-row" onclick="setMode('search')">
						<i class="fa-solid fa-plus"></i> Add Side Dish or Drink
					</div>

					<div class="quick-log-row">
						<div>
							<strong>Copy Yesterday Breakfast</strong>
							<span>Oatmeal and berries - 320 kcal</span>
						</div>
						<button class="quick-log-btn" onclick="quickLog()">
							Copy
						</button>
					</div>

					<!-- Totals -->
					<div class="macro-summary">
						<div style="display: flex; gap: 8px">
							<span class="macro-tag"
								>P: <span id="protVal">62</span>g</span
							>
							<span class="macro-tag"
								>F: <span id="fatVal">48</span>g</span
							>
						</div>
						<div class="total-cals">
							<span id="calVal">850</span> kcal
						</div>
					</div>

					<button
						class="save-btn"
						id="logActionBtn"
						onclick="handleLogAction()"
					>
						<i class="fa-solid fa-check"></i> Log to Diary
					</button>
				</div>
			</div>
		</div>

		<div class="modal" id="navModal">
			<div class="modal-card">
				<div class="modal-header">
					<div class="modal-title">Quick Switch</div>
					<button
						class="modal-close"
						onclick="closeModal('navModal')"
					>
						<i class="fa-solid fa-xmark"></i>
					</button>
				</div>
				<div class="nav-grid">
					<a class="nav-tile" href="Dashbaord.html"
						><i class="fa-solid fa-house"></i> Dashboard</a
					>
					<a class="nav-tile" href="Planner.html"
						><i class="fa-regular fa-calendar-days"></i> Planner</a
					>
					<a class="nav-tile" href="Analytics.html"
						><i class="fa-solid fa-chart-simple"></i> Analytics</a
					>
					<a class="nav-tile" href="Settings.html"
						><i class="fa-regular fa-user"></i> Settings</a
					>
				</div>
			</div>
		</div>

		<div class="modal" id="logModal">
			<div class="modal-card">
				<div class="modal-header">
					<div class="modal-title">Meal Logged</div>
					<button
						class="modal-close"
						onclick="closeModal('logModal')"
					>
						<i class="fa-solid fa-xmark"></i>
					</button>
				</div>
				<div style="font-size: 13px; color: var(--text-secondary)">
					Your meal was added to the diary. Ready to review insights?
				</div>
				<div class="modal-actions">
					<a class="btn-primary" href="Analytics.html">View Diary</a>
					<a class="btn-secondary" href="Dashbaord.html">Back Home</a>
				</div>
			</div>
		</div>

		<div class="toast" id="toast">Saved</div>

		<!-- Simple JS for Prototype Interaction -->
		<script>
			const portionOptions = [0.75, 1, 1.5];
			const impactItems = {
				caffeine: {
					name: "Cold Brew Coffee",
					desc: "Caffeine - 5 kcal",
					cals: 5,
					protein: 0,
					fat: 0,
					impact: "caffeine",
					image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
				alcohol: {
					name: "Gin and Tonic",
					desc: "Alcohol - 200 kcal",
					cals: 200,
					protein: 0,
					fat: 0,
					impact: "alcohol",
					image: "https://images.unsplash.com/photo-1461009683692-68a47c8a75fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
			};
			const searchCatalog = [
				impactItems.caffeine,
				impactItems.alcohol,
				{
					name: "Ribeye Steak",
					desc: "High Protein - Iron Rich - 850 kcal",
					cals: 850,
					protein: 62,
					fat: 48,
					image: "https://images.unsplash.com/photo-1544025162-d76694265947?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
				{
					name: "Protein Smoothie",
					desc: "Whey - Banana - 260 kcal",
					cals: 260,
					protein: 24,
					fat: 4,
					image: "https://images.unsplash.com/photo-1505253716362-afaea1d3d1af?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
				{
					name: "Oatmeal and Berries",
					desc: "Fiber Boost - 320 kcal",
					cals: 320,
					protein: 12,
					fat: 6,
					image: "https://images.unsplash.com/photo-1490474418585-ba9bad8fd0ea?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
				{
					name: "Avocado Toast",
					desc: "Healthy Fats - 280 kcal",
					cals: 280,
					protein: 8,
					fat: 14,
					image: "https://images.unsplash.com/photo-1525351484163-7529414344d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
				{
					name: "Greek Yogurt Bowl",
					desc: "Probiotic - 210 kcal",
					cals: 210,
					protein: 18,
					fat: 4,
					image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
				{
					name: "Salmon Power Bowl",
					desc: "Omega 3 - 520 kcal",
					cals: 520,
					protein: 34,
					fat: 18,
					image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				},
			];

			const barcodeItem = {
				name: "Blueberry Protein Bar",
				desc: "Packaged Snack - 220 kcal",
				cals: 220,
				protein: 12,
				fat: 9,
				image: "https://images.unsplash.com/photo-1543339318-b43dc53e19e6?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
			};

			let foodItems = [];
			let toastTimer;
			let barcodeTimer;
			let itemCounter = 0;
			let offlineMode = false;
			let uploadMode = "online";

			function createItem(data) {
				itemCounter += 1;
				return {
					id: "item-" + itemCounter,
					name: data.name,
					desc: data.desc,
					cals: data.cals,
					protein: data.protein,
					fat: data.fat,
					image: data.image,
					impact: data.impact || null,
					portionIndex: 1,
				};
			}

			function initItems() {
				const baseItem =
					searchCatalog.find(
						(item) => item.name === "Ribeye Steak",
					) || searchCatalog[0];
				foodItems = [createItem(baseItem)];
				renderFoodItems();
			}

			function renderFoodItems() {
				const list = document.getElementById("foodList");
				if (!list) {
					return;
				}
				list.innerHTML = "";
				foodItems.forEach((item) => {
					const card = document.createElement("div");
					card.className = "food-item-card";

					const img = document.createElement("img");
					img.className = "food-thumb";
					img.alt = item.name;
					img.src = item.image;

					const details = document.createElement("div");
					details.className = "food-details";

					const title = document.createElement("h3");
					title.textContent = item.name;
					const desc = document.createElement("p");
					desc.textContent = item.desc;

					const portion = document.createElement("div");
					portion.className = "portion-control-container";
					const label = document.createElement("span");
					label.className = "portion-label";
					label.textContent = "Est. Size";
					const slider = document.createElement("div");
					slider.className = "portion-slider";

					const bg = document.createElement("div");
					bg.className = "p-bg";
					bg.style.left = item.portionIndex * 33.33 + "%";
					slider.appendChild(bg);

					const labels = ["Small", "Med", "Large"];
					labels.forEach((text, index) => {
						const opt = document.createElement("div");
						opt.className =
							"p-option" +
							(index === item.portionIndex ? " active" : "");
						opt.textContent = text;
						opt.addEventListener("click", () =>
							setPortion(item.id, index),
						);
						slider.appendChild(opt);
					});

					portion.appendChild(label);
					portion.appendChild(slider);
					details.appendChild(title);
					details.appendChild(desc);
					details.appendChild(portion);

					const remove = document.createElement("div");
					remove.className = "remove-btn";
					remove.innerHTML =
						'<i class="fa-solid fa-circle-minus"></i>';
					remove.addEventListener("click", () => removeItem(item.id));

					card.appendChild(img);
					card.appendChild(details);
					card.appendChild(remove);
					list.appendChild(card);
				});

				updateTotals();
			}

			function updateTotals() {
				let totalCals = 0;
				let totalProt = 0;
				let totalFat = 0;

				foodItems.forEach((item) => {
					const mult = portionOptions[item.portionIndex] || 1;
					totalCals += item.cals * mult;
					totalProt += item.protein * mult;
					totalFat += item.fat * mult;
				});

				document.getElementById("calVal").textContent =
					Math.round(totalCals);
				document.getElementById("protVal").textContent =
					Math.round(totalProt);
				document.getElementById("fatVal").textContent =
					Math.round(totalFat);
			}

			function setPortion(itemId, index) {
				const item = foodItems.find((entry) => entry.id === itemId);
				if (!item) {
					return;
				}
				item.portionIndex = index;
				renderFoodItems();
			}

			function removeItem(itemId) {
				foodItems = foodItems.filter((entry) => entry.id !== itemId);
				renderFoodItems();
				showToast("Item removed");
			}

			function addFoodItem(data) {
				const item = createItem(data);
				foodItems.push(item);
				renderFoodItems();
				openSheet();
				if (item.impact) {
					storeImpact(item.impact);
				}
				showToast("Added " + data.name);
				vibrate("success");
			}

			function snapPhoto() {
				openSheet();
				if (offlineMode) {
					setUploadMode("offline");
					showToast("No signal. Save for later.", "warning");
					return;
				}
				setUploadMode("online");
				showToast("Photo analyzed");
			}

			function openSheet() {
				document.body.classList.add("sheet-active");
			}

			function closeSheet() {
				document.body.classList.remove("sheet-active");
			}

			function setUploadMode(mode) {
				uploadMode = mode;
				const btn = document.getElementById("logActionBtn");
				if (!btn) {
					return;
				}
				if (mode === "offline") {
					btn.innerHTML =
						'<i class="fa-solid fa-cloud-arrow-up"></i> Save for Later';
				} else {
					btn.innerHTML =
						'<i class="fa-solid fa-check"></i> Log to Diary';
				}
			}

			function handleLogAction() {
				if (uploadMode === "offline") {
					saveForLater();
					return;
				}
				openModal("logModal");
				vibrate("success");
			}

			function saveForLater() {
				const current = Number(safeStorageGet("pendingUploads") || 0);
				safeStorageSet("pendingUploads", String(current + 1));
				showToast("Saved offline. Upload queued.", "success");
				closeSheet();
			}

			function setMode(mode) {
				document.querySelectorAll(".mode-item").forEach((item) => {
					item.classList.toggle("active", item.dataset.mode === mode);
				});
				if (mode === "search") {
					openSearch();
				} else {
					closeSearch();
				}
			}

			function toggleOffline() {
				offlineMode = !offlineMode;
				document.body.classList.toggle("offline-on", offlineMode);
				const toggle = document.getElementById("offlineToggle");
				if (toggle) {
					toggle.classList.toggle("offline-active", offlineMode);
					toggle.innerHTML = offlineMode
						? '<i class="fa-solid fa-signal-slash"></i>'
						: '<i class="fa-solid fa-signal"></i>';
				}
				if (offlineMode) {
					setUploadMode("offline");
					showToast("Offline mode enabled");
				} else {
					setUploadMode("online");
					showToast("Back online");
				}
			}

			function openSearch() {
				document.body.classList.add("search-active");
				const input = document.getElementById("searchInput");
				if (input) {
					input.focus();
					filterSearch();
				}
			}

			function closeSearch() {
				document.body.classList.remove("search-active");
				closeCustomFood();
			}

			function addImpactItem(type) {
				const item = impactItems[type];
				if (!item) {
					return;
				}
				addFoodItem(item);
				closeSearch();
				setMode("scan");
			}

			function storeImpact(type) {
				const payload = JSON.stringify({
					type: type,
					time: Date.now(),
				});
				safeStorageSet("lastImpact", payload);
			}

			function filterSearch() {
				const query = (
					document.getElementById("searchInput").value || ""
				).toLowerCase();
				const results = searchCatalog.filter((item) =>
					item.name.toLowerCase().includes(query),
				);
				renderSearchResults(results);
			}

			function renderSearchResults(results) {
				const list = document.getElementById("searchResults");
				const empty = document.getElementById("searchEmpty");
				if (!list || !empty) {
					return;
				}
				list.innerHTML = "";
				if (!results.length) {
					empty.style.display = "block";
					return;
				}
				empty.style.display = "none";
				closeCustomFood();
				results.forEach((item) => {
					const row = document.createElement("div");
					row.className = "search-item";
					const info = document.createElement("div");
					info.className = "search-info";
					info.innerHTML =
						"<strong>" +
						item.name +
						"</strong><span>" +
						item.desc +
						"</span>";
					const btn = document.createElement("button");
					btn.className = "search-add";
					btn.textContent = "Add";
					btn.addEventListener("click", () => {
						addFoodItem(item);
						closeSearch();
						setMode("scan");
					});
					row.appendChild(info);
					row.appendChild(btn);
					list.appendChild(row);
				});
			}

			function openCustomFood() {
				const panel = document.getElementById("customFoodPanel");
				if (panel) {
					panel.classList.add("active");
				}
				const nameInput = document.getElementById("customName");
				const searchInput = document.getElementById("searchInput");
				if (nameInput && searchInput) {
					nameInput.value = searchInput.value.trim();
				}
			}

			function closeCustomFood() {
				const panel = document.getElementById("customFoodPanel");
				if (panel) {
					panel.classList.remove("active");
				}
			}

			function saveCustomFood() {
				const name = document.getElementById("customName").value.trim();
				const calories = Number(
					document.getElementById("customCalories").value || 0,
				);
				const protein = Number(
					document.getElementById("customProtein").value || 0,
				);
				const fat = Number(
					document.getElementById("customFat").value || 0,
				);
				const isPublic =
					document.getElementById("customPublic").checked;
				if (!name || !calories) {
					showToast("Name and calories required", "error");
					vibrate("error");
					return;
				}
				const newItem = {
					name: name,
					desc:
						(isPublic ? "Public" : "Personal") +
						" - " +
						calories +
						" kcal",
					cals: calories,
					protein: protein,
					fat: fat,
					image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80",
				};
				searchCatalog.unshift(newItem);
				closeCustomFood();
				document.getElementById("searchInput").value = "";
				filterSearch();
				addFoodItem(newItem);
				showToast("Custom food added", "success");
			}

			function quickLog() {
				const quickItem = searchCatalog.find(
					(item) => item.name === "Oatmeal and Berries",
				);
				if (quickItem) {
					addFoodItem(quickItem);
				} else {
					showToast("Copied to diary");
				}
				vibrate("success");
			}

			function toggleBarcode() {
				const overlay = document.getElementById("barcodeOverlay");
				if (!overlay) {
					return;
				}
				const isOpen = overlay.classList.contains("active");
				if (isOpen) {
					overlay.classList.remove("active");
					return;
				}
				overlay.classList.add("active");
				startBarcodeScan();
			}

			function startBarcodeScan() {
				const status = document.getElementById("barcodeStatus");
				const card = document.getElementById("barcodeCard");
				const nameEl = document.getElementById("barcodeName");
				const macrosEl = document.getElementById("barcodeMacros");
				if (status) {
					status.textContent = "Scanning barcode...";
				}
				if (card) {
					card.classList.remove("show");
				}
				if (nameEl) {
					nameEl.textContent = barcodeItem.name;
				}
				if (macrosEl) {
					macrosEl.textContent =
						barcodeItem.cals +
						" kcal - " +
						barcodeItem.protein +
						"g Protein - " +
						barcodeItem.fat +
						"g Fat";
				}
				clearTimeout(barcodeTimer);
				barcodeTimer = setTimeout(() => {
					if (status) {
						status.textContent = "Barcode detected";
					}
					if (card) {
						card.classList.add("show");
					}
				}, 900);
			}

			function addBarcodeItem() {
				addFoodItem(barcodeItem);
				toggleBarcode();
				vibrate("success");
			}

			function barcodeNotFound() {
				const status = document.getElementById("barcodeStatus");
				const card = document.getElementById("barcodeCard");
				if (status) {
					status.textContent =
						"No barcode detected. Try again or enter manually.";
				}
				if (card) {
					card.classList.remove("show");
				}
				showToast("Barcode not found", "error");
				vibrate("error");
			}

			function showToast(message, type) {
				const toast = document.getElementById("toast");
				toast.textContent = message;
				toast.classList.remove("success", "error", "warning");
				if (type) {
					toast.classList.add(type);
				}
				toast.classList.add("show");
				clearTimeout(toastTimer);
				toastTimer = setTimeout(() => {
					toast.classList.remove(
						"show",
						"success",
						"error",
						"warning",
					);
				}, 1600);
			}

			function vibrate(kind) {
				if (!navigator.vibrate) {
					return;
				}
				if (kind === "error") {
					navigator.vibrate([60, 40, 60]);
				} else {
					navigator.vibrate(25);
				}
			}

			function safeStorageGet(key) {
				try {
					return localStorage.getItem(key);
				} catch (err) {
					return null;
				}
			}

			function safeStorageSet(key, value) {
				try {
					localStorage.setItem(key, value);
				} catch (err) {
					return;
				}
			}

			function openModal(id) {
				const modal = document.getElementById(id);
				if (modal) {
					modal.classList.add("active");
				}
			}

			function closeModal(id) {
				const modal = document.getElementById(id);
				if (modal) {
					modal.classList.remove("active");
				}
			}

			initItems();
			renderSearchResults(searchCatalog);
			setUploadMode("online");
		</script>
	</body>
</html>
