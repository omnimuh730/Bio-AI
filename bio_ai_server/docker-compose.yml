services:
    bio-ai-server:
        build: .
        env_file: .env
        ports:
            - "8000:8000"
        volumes:
            - ./uploads:/app/uploads
        restart: unless-stopped
        healthcheck:
            test: ["CMD-SHELL", "curl -f http://localhost:8000/ || exit 1"]
            interval: 10s
            timeout: 5s
            retries: 6

    # Development service (activated by setting COMPOSE_PROFILES=dev)
    bio-ai-server-dev:
        build: .
        env_file: .env
        ports:
            - "8000:8000"
        volumes:
            - ./:/app:cached
            - ./uploads:/app/uploads
        command: uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
        profiles:
            - dev

volumes:
    mongo_data:

# Usage:
# - For development: set ENV=dev in your .env and run `COMPOSE_PROFILES=dev docker compose up --build` to enable hot-reload mounts
# - For stage/prod: set ENV=stage|prod and run `docker compose up --build -d` (the plain service will run)

